@model IEnumerable<EventManagement.Models.Event>

@{
    ViewData["Title"] = "Browse Events";
    var categories = ViewData["Categories"] as List<string>;
}

<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="display-4">Upcoming Events</h1>
        <p class="lead ">Discover and join events hosted by our community.</p>
    </div>
    
    <div class="row mb-4 align-items-center">
        <div class="col-md-8">
            <form asp-action="Index" method="get">
                <div class="input-group">
                    <input type="text" name="searchString" value="@ViewData["CurrentFilter"]" placeholder="Search events..." class="form-control" />
                    <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i></button>
                </div>
            </form>
        </div>
        <div class="d-flex justify-content-center gap-2 mb-5">
    <form asp-action="Index" method="get" id="sortForm">
        <select name="sortOrder" class="form-select" onchange="this.form.submit()">
            <option value="">Sort by Name</option>
            <option value="Date">Sort by Date</option>
        </select>
    </form>
    
    <div class="dropdown">
        <button class="btn btn-outline-light dropdown-toggle" type="button" id="categoryDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            Filter by Category
        </button>
        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="categoryDropdown">
            <li><a class="dropdown-item" asp-action="Index">All</a></li>
            @if (categories != null)
            {
                @foreach (var cat in categories)
                {
                    <li><a class="dropdown-item" asp-action="Index" asp-route-category="@cat">@cat</a></li>
                }
            }
        </ul>
    </div>
</div>
    </div>

    @* <div class="text-center mb-5">
        <a asp-action="Index" class="btn btn-outline-light me-2">All</a>
        @if (categories != null)
        {
            @foreach (var cat in categories)
            {
                <a asp-action="Index" asp-route-category="@cat" class="btn btn-outline-light me-2">@cat</a>
            }
        }
    </div> *@

    <div class="event-grid">
        @foreach (var ev in Model)
        {
            <a asp-action="Details" asp-route-id="@ev.EventId" class="event-card-link">
                <div class="event-card">
                    <div class="event-card-body">
                        <h5 class="event-card-title">@ev.Title</h5>
                        <p class="event-card-date">@ev.EventDateTime.ToString("dddd, dd MMMM yyyy 'at' h:mm tt")</p>
                        <p class="event-card-text">@ev.Fees$</p>
                    </div>
                    <div class="event-card-footer">
                        <span>@(ev.Registrations?.Count() ?? 0) / @ev.MaxParticipants Spots Taken</span>
                        <span class="view-details-prompt">View Details &rarr;</span>
                    </div>
                </div>
            </a>
        }
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('searchInput');
            const eventGrid = document.getElementById('eventGrid');
            const eventContainers = eventGrid.querySelectorAll('.event-container');

            searchInput.addEventListener('keyup', function () {
                const searchTerm = searchInput.value.toLowerCase();

                eventContainers.forEach(container => {
                    const title = container.querySelector('.event-title').textContent.toLowerCase();
                    if (title.includes(searchTerm)) {
                        container.style.display = 'block';
                    } else {
                        container.style.display = 'none';
                    }
                });
            });
        });
    </script>
}